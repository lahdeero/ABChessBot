<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Generator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ABChessbot</a> &gt; <a href="index.source.html" class="el_package">abcb.simulate</a> &gt; <span class="el_source">Generator.java</span></div><h1>Generator.java</h1><pre class="source lang-java linenums">package abcb.simulate;

import abcb.datastructure.MyRecord;
import static abcb.simulate.Position.*;

<span class="fc" id="L6">public class Generator {</span>

    public Position currentPosition;

    /**
     * @return Classic chess starting position
     */
    public Position createStartingPosition() {
<span class="fc" id="L14">        int[][] board = new int[8][8];</span>
<span class="fc bfc" id="L15" title="All 2 branches covered.">        for (int i = 0; i &lt; 8; i++) {</span>
<span class="fc" id="L16">            board[1][i] = blackPawn;</span>
<span class="fc" id="L17">            board[6][i] = whitePawn;</span>
        }
<span class="fc" id="L19">        board[0][0] = blackRook;</span>
<span class="fc" id="L20">        board[0][1] = blackKnight;</span>
<span class="fc" id="L21">        board[0][2] = blackBishop;</span>
<span class="fc" id="L22">        board[0][3] = blackQueen;</span>
<span class="fc" id="L23">        board[0][4] = blackKing;</span>
<span class="fc" id="L24">        board[0][5] = blackBishop;</span>
<span class="fc" id="L25">        board[0][6] = blackKnight;</span>
<span class="fc" id="L26">        board[0][7] = blackRook;</span>
<span class="fc" id="L27">        board[7][0] = whiteRook;</span>
<span class="fc" id="L28">        board[7][1] = whiteKnight;</span>
<span class="fc" id="L29">        board[7][2] = whiteBishop;</span>
<span class="fc" id="L30">        board[7][3] = whiteQueen;</span>
<span class="fc" id="L31">        board[7][4] = whiteKing;</span>
<span class="fc" id="L32">        board[7][5] = whiteBishop;</span>
<span class="fc" id="L33">        board[7][6] = whiteKnight;</span>
<span class="fc" id="L34">        board[7][7] = whiteRook;</span>

<span class="fc" id="L36">        Position startingPosition = new Position(board, true);</span>
<span class="fc" id="L37">        startingPosition.whiteCastleKingSide = true;</span>
<span class="fc" id="L38">        startingPosition.whiteCastleQueenSide = true;</span>
<span class="fc" id="L39">        startingPosition.blackCastleKingSide = true;</span>
<span class="fc" id="L40">        startingPosition.blackCastleQueenSide = true;</span>
        
<span class="fc" id="L42">        return startingPosition;</span>
    }

    /**
     * Generates all possible positions after current position.
     *
     * @param currentPosition
     * @return List&lt;Position&gt;
     */
    public MyRecord&lt;Position&gt; getNextPositions(Position currentPosition) {
<span class="fc" id="L52">        this.currentPosition = currentPosition;</span>
//        List&lt;Position&gt; nextPositions = Collections.synchronizedList(new MyRecord&lt;&gt;());
<span class="fc" id="L54">        MyRecord&lt;Position&gt; nextPositions = new MyRecord&lt;&gt;();</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">        for (int y = 0; y &lt; 8; y++) {</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">            for (int x = 0; x &lt; 8; x++) {</span>
<span class="fc" id="L57">                int piece = currentPosition.board[y][x];</span>
<span class="fc bfc" id="L58" title="All 2 branches covered.">                if (piece == 0) {</span>
<span class="fc" id="L59">                    continue;</span>
                }
<span class="fc bfc" id="L61" title="All 2 branches covered.">                if (!currentPosition.whitesMove) { // BLACK</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">                    if (piece == blackPawn) {</span>
<span class="fc" id="L63">                        blackPawnMoves(x, y, nextPositions);</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">                    } else if (piece == blackRook) {</span>
<span class="fc" id="L65">                        nextPositions.addAll(rookMoves(x, y, blackRook));</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">                    } else if (piece == blackKnight) {</span>
<span class="fc" id="L67">                        nextPositions.addAll(knightMoves(x, y, blackKnight));</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">                    } else if (piece == blackBishop) {</span>
<span class="fc" id="L69">                        nextPositions.addAll(bishopMoves(x, y, blackBishop));</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">                    } else if (piece == blackQueen) {</span>
<span class="fc" id="L71">                        nextPositions.addAll(queenMoves(x, y, blackQueen));</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">                    } else if (piece == blackKing) {</span>
<span class="fc" id="L73">                        nextPositions.addAll(kingMoves(x, y, blackKing));</span>
                    }
                } else {  // WHITE
<span class="fc bfc" id="L76" title="All 2 branches covered.">                    if (piece == whitePawn) {</span>
<span class="fc" id="L77">                        whitePawnMoves(x, y, nextPositions);</span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">                    } else if (piece == whiteRook) {</span>
<span class="fc" id="L79">                        nextPositions.addAll(rookMoves(x, y, whiteRook));</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">                    } else if (piece == whiteKnight) {</span>
<span class="fc" id="L81">                        nextPositions.addAll(knightMoves(x, y, whiteKnight));</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">                    } else if (piece == whiteBishop) {</span>
<span class="fc" id="L83">                        nextPositions.addAll(bishopMoves(x, y, whiteBishop));</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">                    } else if (piece == whiteQueen) {</span>
<span class="fc" id="L85">                        nextPositions.addAll(queenMoves(x, y, whiteQueen));</span>
<span class="fc bfc" id="L86" title="All 2 branches covered.">                    } else if (piece == whiteKing) {</span>
<span class="fc" id="L87">                        nextPositions.addAll(kingMoves(x, y, whiteKing));</span>
                    }
                }
            }
        }
<span class="fc" id="L92">        return nextPositions;</span>
    }

    private MyRecord&lt;Position&gt; rookMoves(int x, int y, int piece) {
<span class="fc" id="L96">        MyRecord&lt;Position&gt; nextRooks = new MyRecord&lt;Position&gt;();</span>
<span class="fc" id="L97">        boolean[] blocked = {false, false, false, false};</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">        for (int i = 1; i &lt; 8; i++) {</span>
<span class="fc bfc" id="L99" title="All 6 branches covered.">            if (!blocked[0] &amp;&amp; insideBoard(x - i, y) &amp;&amp; !occupied(x - i, y, piece)) {</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">                if (eats(x - i, y, piece)) {</span>
<span class="fc" id="L101">                    blocked[0] = true;</span>
                }
<span class="fc" id="L103">                nextRooks.add(createPosition(x, y, x - i, y, piece));</span>
            } else {
<span class="fc" id="L105">                blocked[0] = true;</span>
            }
<span class="fc bfc" id="L107" title="All 6 branches covered.">            if (!blocked[1] &amp;&amp; insideBoard(x + i, y) &amp;&amp; !occupied(x + i, y, piece)) {</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">                if (eats(x + i, y, piece)) {</span>
<span class="fc" id="L109">                    blocked[1] = true;</span>
                }
<span class="fc" id="L111">                nextRooks.add(createPosition(x, y, x + i, y, piece));</span>
            } else {
<span class="fc" id="L113">                blocked[1] = true;</span>
            }
<span class="fc bfc" id="L115" title="All 6 branches covered.">            if (!blocked[2] &amp;&amp; insideBoard(x, y - i) &amp;&amp; !occupied(x, y - i, piece)) {</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">                if (eats(x, y - i, piece)) {</span>
<span class="fc" id="L117">                    blocked[2] = true;</span>
                }
<span class="fc" id="L119">                nextRooks.add(createPosition(x, y, x, y - i, piece));</span>
            } else {
<span class="fc" id="L121">                blocked[2] = true;</span>
            }
<span class="fc bfc" id="L123" title="All 6 branches covered.">            if (!blocked[3] &amp;&amp; insideBoard(x, y + i) &amp;&amp; !occupied(x, y + i, piece)) {</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">                if (eats(x, y + i, piece)) {</span>
<span class="fc" id="L125">                    blocked[3] = true;</span>
                }
<span class="fc" id="L127">                nextRooks.add(createPosition(x, y, x, y + i, piece));</span>
            } else {
<span class="fc" id="L129">                blocked[3] = true;</span>
            }
        }
<span class="fc" id="L132">        return nextRooks;</span>
    }

    private MyRecord&lt;Position&gt; bishopMoves(int x, int y, int piece) {
<span class="fc" id="L136">        MyRecord&lt;Position&gt; nextBishops = new MyRecord&lt;Position&gt;();</span>
<span class="fc" id="L137">        int k = -1;</span>
<span class="fc" id="L138">        int e = -1;</span>
<span class="fc bfc" id="L139" title="All 2 branches covered.">        for (int j = 0; j &lt; 4; j++) {</span>
<span class="fc" id="L140">            int i = 1;</span>
<span class="fc bfc" id="L141" title="All 4 branches covered.">            while (insideBoard(x + (k * i), y + (e * i)) &amp;&amp; !occupied(x + (k * i), y + (e * i), piece)) {</span>
<span class="fc" id="L142">                boolean eating = false;</span>
<span class="fc bfc" id="L143" title="All 2 branches covered.">                if (eats(x + k * i, y + e * i, piece)) {</span>
<span class="fc" id="L144">                    eating = true;</span>
                }
<span class="fc" id="L146">                Position p = new Position();</span>
<span class="fc" id="L147">                p.clonePosition(currentPosition, x, y);</span>
<span class="fc" id="L148">                p.board[y + e * i][x + k * i] = piece;</span>
<span class="fc" id="L149">                nextBishops.add(p);</span>
<span class="fc bfc" id="L150" title="All 2 branches covered.">                if (eating) {</span>
<span class="fc" id="L151">                    break;</span>
                }
<span class="fc" id="L153">                i++;</span>
<span class="fc" id="L154">            }</span>
<span class="fc bfc" id="L155" title="All 4 branches covered.">            if (k == -1 &amp;&amp; e == -1) {</span>
<span class="fc" id="L156">                e = 1;</span>
<span class="pc bpc" id="L157" title="1 of 4 branches missed.">            } else if (k == -1 &amp;&amp; e == 1) {</span>
<span class="fc" id="L158">                k = 1;</span>
<span class="fc" id="L159">                e = -1;</span>
<span class="pc bpc" id="L160" title="1 of 4 branches missed.">            } else if (k == 1 &amp;&amp; e == -1) {</span>
<span class="fc" id="L161">                e = 1;</span>
            }
        }
<span class="fc" id="L164">        return nextBishops;</span>
    }

    private MyRecord&lt;Position&gt; queenMoves(int x, int y, int piece) {
<span class="fc" id="L168">        MyRecord&lt;Position&gt; queenMoves = new MyRecord&lt;Position&gt;();</span>
<span class="fc" id="L169">        queenMoves.addAll(rookMoves(x, y, piece));</span>
<span class="fc" id="L170">        queenMoves.addAll(bishopMoves(x, y, piece));</span>
<span class="fc" id="L171">        return queenMoves;</span>
    }

    private MyRecord&lt;Position&gt; kingMoves(int x, int y, int piece) {
<span class="fc" id="L175">        MyRecord&lt;Position&gt; nextKings = new MyRecord&lt;Position&gt;();</span>
<span class="fc bfc" id="L176" title="All 2 branches covered.">        for (int i = -1; i &lt;= 1; i++) {</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">            for (int j = -1; j &lt;= 1; j++) {</span>
<span class="fc bfc" id="L178" title="All 4 branches covered.">                if (i == 0 &amp;&amp; j == 0) {</span>
<span class="fc" id="L179">                    continue;</span>
                }
<span class="fc bfc" id="L181" title="All 4 branches covered.">                if (insideBoard(x + j, y + i) &amp;&amp; !occupied(x + j, y + i, piece)) {</span>
<span class="fc" id="L182">                    Position p = new Position();</span>
<span class="fc" id="L183">                    p.clonePosition(currentPosition, x, y);</span>
<span class="fc" id="L184">                    p.board[y + i][x + j] = piece;</span>
<span class="fc" id="L185">                    nextKings.add(p);</span>
                }
            }
        }
<span class="fc" id="L189">        return nextKings;</span>
    }

    private MyRecord&lt;Position&gt; knightMoves(int x, int y, int piece) {
<span class="fc" id="L193">        MyRecord&lt;Position&gt; nextKnights = new MyRecord&lt;&gt;();</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">        for (int i = -2; i &lt;= 2; i++) {</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">            for (int j = -2; j &lt;= 2; j++) {</span>
<span class="fc bfc" id="L196" title="All 6 branches covered.">                if (Math.abs(i) + Math.abs(j) == 3 &amp;&amp; insideBoard(x + i, y + j) &amp;&amp; !occupied(x + i, y + j, piece)) {</span>
<span class="fc" id="L197">                    Position p = new Position();</span>
<span class="fc" id="L198">                    p.clonePosition(currentPosition, x, y);</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">                    p.board[y + j][x + i] = piece &lt; 20 ? whiteKnight : blackKnight;</span>
<span class="fc" id="L200">                    nextKnights.add(p);</span>
                }
            }
        }
<span class="fc" id="L204">        return nextKnights;</span>
    }

    private MyRecord&lt;Position&gt; blackPawnMoves(int x, int y, MyRecord&lt;Position&gt; nextPositions) {
<span class="fc" id="L208">        boolean moves[] = new boolean[4];</span>
<span class="pc bpc" id="L209" title="1 of 4 branches missed.">        moves[0] = insideBoard(y + 1, x) &amp;&amp; currentPosition.board[y + 1][x] == 0;</span>
<span class="fc bfc" id="L210" title="All 6 branches covered.">        moves[1] = y == 1 &amp;&amp; currentPosition.board[y + 1][x] == 0 &amp;&amp; currentPosition.board[y + 2][x] == 0;</span>
<span class="fc bfc" id="L211" title="All 4 branches covered.">        moves[2] = insideBoard(x - 1, y - 1) &amp;&amp; eats(x - 1, y + 1, blackPawn);</span>
<span class="fc bfc" id="L212" title="All 4 branches covered.">        moves[3] = insideBoard(x + 1, y - 1) &amp;&amp; eats(x + 1, y + 1, blackPawn);</span>

<span class="fc bfc" id="L214" title="All 2 branches covered.">        if (moves[0]) {</span>
<span class="fc" id="L215">            Position p = new Position();</span>
<span class="fc" id="L216">            p.clonePosition(currentPosition, x, y);</span>
<span class="fc" id="L217">            pawnMoves(blackPawn, p, x, y+1);</span>
<span class="fc" id="L218">            nextPositions.add(p);</span>
        }
<span class="fc bfc" id="L220" title="All 2 branches covered.">        if (moves[1]) {</span>
<span class="fc" id="L221">            Position p = new Position();</span>
<span class="fc" id="L222">            p.clonePosition(currentPosition, x, y);</span>
<span class="fc" id="L223">            p.board[y + 2][x] = blackPawn; // no need to use PawnMoves</span>
<span class="fc" id="L224">            nextPositions.add(p);</span>
        }
<span class="fc bfc" id="L226" title="All 2 branches covered.">        if (moves[2]) {</span>
<span class="fc" id="L227">            Position p = new Position();</span>
<span class="fc" id="L228">            p.clonePosition(currentPosition, x, y);</span>
//            p.board[y + 1][x - 1] = blackPawn;
<span class="fc" id="L230">            pawnMoves(blackPawn, p, x-1, y+1);</span>
<span class="fc" id="L231">            nextPositions.add(p);</span>
        }
<span class="fc bfc" id="L233" title="All 2 branches covered.">        if (moves[3]) {</span>
<span class="fc" id="L234">            Position p = new Position();</span>
<span class="fc" id="L235">            p.clonePosition(currentPosition, x, y);</span>
//            p.board[y + 1][x + 1] = blackPawn;
<span class="fc" id="L237">            pawnMoves(blackPawn, p, x+1, y+1);</span>
<span class="fc" id="L238">            nextPositions.add(p);</span>
        }
<span class="fc" id="L240">        return nextPositions;</span>
    }
    
    private Position pawnMoves(int piece, Position p, int nx, int ny) {
<span class="fc bfc" id="L244" title="All 2 branches covered.">        if (piece == 25) {</span>
<span class="fc bfc" id="L245" title="All 2 branches covered.">            if (ny == 7) {</span>
<span class="fc" id="L246">                p.board[ny][nx] = blackQueen;</span>
            } else {
<span class="fc" id="L248">                p.board[ny][nx] = blackPawn;</span>
            }
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">        } else if (piece == 15) {</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">            if (ny == 0) {</span>
<span class="fc" id="L252">                p.board[ny][nx] = whiteQueen;</span>
            } else {
<span class="fc" id="L254">                p.board[ny][nx] = whitePawn;</span>
            }
        }
<span class="fc" id="L257">        return p;</span>
    }

    private MyRecord&lt;Position&gt; whitePawnMoves(int x, int y, MyRecord&lt;Position&gt; nextPositions) {
<span class="fc" id="L261">        boolean moves[] = new boolean[4];</span>
<span class="pc bpc" id="L262" title="1 of 4 branches missed.">        moves[0] = insideBoard(x, y - 1) &amp;&amp; currentPosition.board[y - 1][x] == 0;</span>
<span class="fc bfc" id="L263" title="All 6 branches covered.">        moves[1] = y == 6 &amp;&amp; currentPosition.board[y - 1][x] == 0 &amp;&amp; currentPosition.board[y - 2][x] == 0;</span>
<span class="fc bfc" id="L264" title="All 4 branches covered.">        moves[2] = insideBoard(x - 1, y - 1) &amp;&amp; eats(x - 1, y - 1, whitePawn);</span>
<span class="fc bfc" id="L265" title="All 4 branches covered.">        moves[3] = insideBoard(x + 1, y - 1) &amp;&amp; eats(x + 1, y - 1, whitePawn);</span>

<span class="fc bfc" id="L267" title="All 2 branches covered.">        if (moves[0]) {</span>
<span class="fc" id="L268">            Position p = new Position();</span>
<span class="fc" id="L269">            p.clonePosition(currentPosition, x, y);</span>
//            p.board[y - 1][x] = whitePawn;
<span class="fc" id="L271">            pawnMoves(whitePawn, p, x, y-1);</span>
<span class="fc" id="L272">            nextPositions.add(p);</span>
        }
<span class="fc bfc" id="L274" title="All 2 branches covered.">        if (moves[1]) {</span>
<span class="fc" id="L275">            Position p = new Position();</span>
<span class="fc" id="L276">            p.clonePosition(currentPosition, x, y);</span>
<span class="fc" id="L277">            p.board[y - 2][x] = whitePawn;</span>
<span class="fc" id="L278">            nextPositions.add(p);</span>
        }
<span class="fc bfc" id="L280" title="All 2 branches covered.">        if (moves[2]) {</span>
<span class="fc" id="L281">            Position p = new Position();</span>
<span class="fc" id="L282">            p.clonePosition(currentPosition, x, y);</span>
//            p.board[y - 1][x - 1] = whitePawn;
<span class="fc" id="L284">            pawnMoves(whitePawn, p, x-1, y-1);</span>
<span class="fc" id="L285">            nextPositions.add(p);</span>
        }
<span class="fc bfc" id="L287" title="All 2 branches covered.">        if (moves[3]) {</span>
<span class="fc" id="L288">            Position p = new Position();</span>
<span class="fc" id="L289">            p.clonePosition(currentPosition, x, y);</span>
//            p.board[y - 1][x + 1] = whitePawn;
<span class="fc" id="L291">            pawnMoves(whitePawn, p, x+1, y-1);</span>
<span class="fc" id="L292">            nextPositions.add(p);</span>
        }
<span class="fc" id="L294">        return nextPositions;</span>
    }

    private boolean occupied(int x, int y, int piece) {
<span class="fc bfc" id="L298" title="All 2 branches covered.">        if (currentPosition.board[y][x] == 0) {</span>
<span class="fc" id="L299">            return false;</span>
        }
<span class="fc bfc" id="L301" title="All 4 branches covered.">        if (currentPosition.board[y][x] &gt;= 20 &amp;&amp; piece &gt;= 20) {</span>
<span class="fc" id="L302">            return true;</span>
<span class="fc bfc" id="L303" title="All 4 branches covered.">        } else if (currentPosition.board[y][x] &lt; 20 &amp;&amp; piece &lt; 20) {</span>
<span class="fc" id="L304">            return true;</span>
        }
<span class="fc" id="L306">        return false;</span>
    }

    private boolean eats(int x, int y, int piece) {
<span class="fc bfc" id="L310" title="All 2 branches covered.">        if (currentPosition.board[y][x] == 0) {</span>
<span class="fc" id="L311">            return false;</span>
        }
<span class="fc bfc" id="L313" title="All 8 branches covered.">        return currentPosition.board[y][x] &lt; 20 &amp;&amp; piece &gt;= 20</span>
                || currentPosition.board[y][x] &gt;= 20 &amp;&amp; piece &lt; 20;
    }

    private Position createPosition(int x, int y, int nx, int ny, int piece) {
<span class="fc" id="L318">        Position p = new Position();</span>
<span class="fc" id="L319">        p.clonePosition(currentPosition, x, y);</span>
<span class="fc" id="L320">        p.board[ny][nx] = piece;</span>
<span class="fc" id="L321">        return p;</span>
    }

    private boolean insideBoard(int x, int y) {
<span class="fc bfc" id="L325" title="All 8 branches covered.">        return x &gt;= 0 &amp;&amp; x &lt;= 7 &amp;&amp; y &gt;= 0 &amp;&amp; y &lt;= 7;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>